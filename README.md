# CPM SMS Notifier

This micro-app creates SMS messages from a HTTP POST request using the Twilio API. This tool was developed because Slack notifications cannot make it to a mobile phone's lock screen if Slack is running on a desktop. This micro-app is meant to be called by any servers that need to send immediate, lock-screen-defying messages.
This micro-app is only to be used for notifying CPM team members.  This is not to be used to send any high-capacity broadcast SMS messages or non-CPM employees.

## System Requirements
* `php` and `php-curl`

## Installation

1. Create `config.php` file outside of server's document root with the following variables:

    * `$notification_token`: String.  Random string to use as security token.  Compared to incoming POST variable `token`. Request will fail if incoming token variable does not match this string.
    * `$slack_webhook_url`: (Optional) URL of a Slack [Incoming Webhook](https://api.slack.com/incoming-webhooks) where copies of all messages will be sent.
    * `$twilio_sid`: String.  SID from Twilio account.
    * `$twilio_phone`: String.  Twilio phone number to use as `From:` value when sending texts.  Do not use punctuation to separate the digits.
    * `$twilio_api`: String. Autogenerated using `$twilio_sid`.  Leave this setting as-is.
    * `$twilio_token`: String. Token from Twilio account.

2. Update `index.php` to point to location of `config.php`

## Usage

Create a POST request to `http://admintools.wbez.org/sms/` (trailing slash required) with the following variables:

* `token`: String. The random string specified in the `$notification_token` variable in the configuration file.
* `recipients`: String. Comma separated list of 9 digit US phone numbers to send the message to.  Do not use punctuation to separate the digits.
* `message`: String. Message to send to users.
* `slackOnly`: Do not send SMS notification.  Only send message to Slack channel (Only when `$slack_webhook_url` is set in the `config.php`);

Example using `curl`:

```/usr/bin/curl -X POST -F "token=[TOKEN]" -F "recipients=[PHONE_NUMBER]" -F "message=[MESSAGE]" http://admintools.wbez.org/sms/```

or use `sms.sh` e.g. `./sms.sh 7088059999 "Sample Message goes here."`

## Logging

All errors and successes are logged using PHP's `error_log` functionality.  You will find the log messages in the web server's error log file.
